<div class="container-fluid">
    <h1>AniJS demo</h1>
    <div>
        <a onClick="addWidget()" class="btn btn-primary" href="#">Add Widget</a>
    </div>
    <br>
    <div class="grid-stack"></div>
</div>

<script src="../uPlot Testing/node_modules/gridstack/dist/gridstack-all.js"></script>
<link href="../uPlot Testing/node_modules/gridstack/dist/gridstack.min.css" rel="stylesheet"/>
<script src="../uPlot Testing/dist/uPlot.iife.js"></script>
<link rel="stylesheet" href="../uPlot Testing/dist/uPlot.min.css">
<style type="text/css">
    .grid-stack { background: #FAFAD2; }
    .grid-stack-item-content { background-color: #18BC9C; }
</style>

<div class="grid-stack"></div>

<script type="text/javascript">
    let grid = GridStack.init();
    let self = this;
    grid.on('added', function(e, items) {
        // add anijs data to gridstack item
        for (let i = 0; i < items.length; i++) {
            //items[i].el.setAttribute('data-anijs', 'if: added, do: swing animated, after: $removeAnimations, on: $gridstack');
            let contentItem = items[i].el.querySelector('.grid-stack-item-content');
            let { width, height } = contentItem.getBoundingClientRect();
            let u = new uPlot({
                width,
                height: height - 50,
                ...sharedOpts
            }, [[1,5], [1,5]], contentItem);
        }
        //self.gridstackNotifier = AniJS.getNotifier('gridstack');
        // fire added event!
        //self.gridstackNotifier.dispatchEvent('added');
    });

    function addWidget() {
        grid.addWidget({w: Math.floor(1 + 3 * Math.random()), h: Math.floor(1 + 3 * Math.random())});
    }

    grid.on('resizestop', (event, item) => {



            let contentItem = item;//[i].el.querySelector('.grid-stack-item-content');
            let { width, height } = contentItem.getBoundingClientRect();
            let u = new uPlot({
                width,
                height: height - 50,
                ...sharedOpts
            }, [[1,5], [1,5]], contentItem);


    })
    /*
    let animationHelper = AniJS.getHelper();

    //Defining removeAnimations to remove existing animations
    animationHelper.removeAnimations = function(e, animationContext) {
        document.querySelectorAll('.grid-stack-item').forEach( function(el) {
            el.removeAttribute('data-anijs');
        });
    }
     */
    const sharedOpts = {
        scales: {
            x: {
                time: false
            }
        },
        series: [
            {},
            {
                stroke: "red"
            },
        ],
    };

    addWidget();

</script>