<div class="container-fluid">
    <div>
        <a onClick="addWidget()" class="btn btn-primary" href="#">Add Widget</a>
    </div>
    <br>
    <div class="grid-stack"></div>
</div>

<script src="../uPlot Testing/node_modules/gridstack/dist/gridstack-all.js"></script>
<link href="../uPlot Testing/node_modules/gridstack/dist/gridstack.min.css" rel="stylesheet"/>
<script src="../uPlot Testing/dist/uPlot.iife.js"></script>
<link rel="stylesheet" href="../uPlot Testing/dist/uPlot.min.css">
<style type="text/css">
    .grid-stack { background: #FAFAD2; }
    .grid-stack-item-content { background-color: #18BC9C; }
</style>

<div class="grid-stack"></div>

<script type="text/javascript">
    let grid = GridStack.init();
    let self = this;
    var contentList = [];
    grid.on('added', function(e, items) {
        // add anijs data to gridstack item
        for (let i = 0; i < items.length; i++) {
            let contentItem = items[i].el.querySelector('.grid-stack-item-content');
            let content=new Object();
            content.id = contentItem.id;
            let { width, height } = contentItem.getBoundingClientRect();
            content.plot = new uPlot({
                width,
                height: height - 50,
                ...sharedOpts
            }, [[1,5], [1,5]], contentItem);
            contentList.push(content);
        }
    });

    function addWidget() {
        grid.addWidget({w: Math.floor(1 + 3 * Math.random()), h: Math.floor(1 + 3 * Math.random())});
    }

    grid.on('resizestop', (event, contentItem) => {
            content = contentList.find((element) => element.id === contentItem.id);
            let { width, height } = contentItem.getBoundingClientRect();
            content.plot.setSize(width, height - 50);
            /*
            content.plot = new uPlot({
                width,
                height: height - 50,
                ...sharedOpts
            }, [[1,5], [1,5]], contentItem);

             */


    })

    const sharedOpts = {
        scales: {
            x: {
                time: false
            }
        },
        series: [
            {},
            {
                stroke: "red"
            },
        ],
    };

    addWidget();

</script>