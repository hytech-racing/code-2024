<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>VectorNav MATLAB Library: getting_started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="proglib.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VectorNav MATLAB Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">getting_started</div>  </div>
</div><!--header-->
<div class="contents">
<p>This example walks through using <b>Mathworks MATLAB</b> to connect to a VectorNav sensor using the compiled <b>VectorNav .NET Library</b>, configure the sensor to output various data types, and then display this data in the <b>MATLAB</b> environment. Once you are familiar with the basics, you will probably be interested in composing scripts that make use of the <b>VectorNav .NET Library</b> in <b>MATLAB</b>. Please see the <a class="el" href="scripting_2scripting_8m-example.html">Scripting</a> example for some pointers on making scripts.</p>
<dl class="section note"><dt>Note</dt><dd>This example was constructed using <em>Mathworks MATLAB R2014b</em> and may need to be adjusted for your specific version.</dd></dl>
<h1><a class="anchor" id="matlabGettingStarted"></a>
Steps</h1>
<ol type="1">
<li>Open <b>MATLAB</b>. Now to connect to a VectorNav sensor requires that we load the compiled <b>VectorNav .NET Library</b> assembly. Once loaded, we will use the functionality within the assembly for configuration and access to the sensor. To load the assembly, you will need to specify the <em>full path</em> to the assembly. The sample command below works with the library extracted in the location <code>C:\vnproglib</code>.<br />
 <code>&gt;&gt; NET.addAssembly('C:\vnproglib\net\bin\win32\VectorNav.dll')</code><br />
</li>
<li><p class="startli">The .NET environment uses namespaces to organize its classes and structures. So that we don't have to type the full namespace of a class when we access it, we will import these namespaces with the commands below.</p>
<p class="startli"><code>&gt;&gt; import VectorNav.Sensor.*</code><br />
 <code>&gt;&gt; import VectorNav.Protocol.Uart.*</code></p>
</li>
<li>Now create an <code>EzAsyncData</code> object connected to our sensor by executing the command below. Note that you will need to modify the COM port and baudrate appropriately for your system.<br />
 <code>&gt;&gt; ez = EzAsyncData.Connect('COM1', 115200)</code></li>
<li>Now all VectorNav sensors in their factory default state will be outputting some type of ASCII asynchronous data message that contains yaw, pitch, roll data. All of the different types of ASCII and binary asynchronous data messages will be automatically processed by the <code>EzAsyncData</code> object and made available through its <code>CurrentData</code> property. To display the current yaw, pitch, roll data, execute the command below.<br />
 <code>&gt;&gt; ez.CurrentData.YawPitchRoll</code><br />
 In fact, you can get all of the current data by just calling the <code>CurrentData</code> property as below.<br />
 <code>&gt;&gt; ez.CurrentData</code></li>
<li><p class="startli">Suppose that your application requires you to have quaternion attitude data. If you request quaternion data from the <code>CurrentData</code> property as illustrated below, there is a good change you will get the displayed "Null object must have a value" error message.</p>
<p class="startli"><code>&gt;&gt; ez.CurrentData.Quaternion<br />
 Message: Nullable object must have a value.<br />
 Source: mscorlib<br />
 HelpLink:</code></p>
<p class="startli">This message indicates that the <code>EzAsyncData</code> has not received any quaternion data and is indicate by accessing the <code>HasQuaternion</code> property.</p>
<p class="startli"><code>&gt;&gt; ez.CurrentData.HasQuaternion<br />
 ans = 0</code></p>
<p class="startli">Now even though the sensor is outputting yaw, pitch, roll data, it is possible to access this orientation data as a quaternion through the <code>AnyAttitude</code> property. This property has the latest attitude information regardless of the type received. Hence, to access quaternion data, execute the command below.<br />
 <code>&gt;&gt; ez.CurrentData.AnyAttitude.Quat</code></p>
</li>
<li><p class="startli">You may also wish to configure the sensor from within <b>MATLAB</b>, for example, we can configure the sensor to output ASCII asynchronous data type VNQTN, which will contain attitude in quaternion format. The <code>EzAsyncData</code> actually wraps a <code>VectorNav.Sensor.VnSensor</code> object that provides methods for changing the configuration and is available through the <code>Sensor</code> property. Now configure the sensor to output VNQTN data by executing the command below.</p>
<p class="startli"><code>&gt;&gt; ez.Sensor.WriteAsyncDataOutputType(AsciiAsync.VNQTN)</code></p>
<p class="startli">You should now be able to directly access quaternion data directly.</p>
<p class="startli"><code>&gt;&gt; ez.CurrentData.Quaternion</code></p>
</li>
<li><p class="startli">Let's now look at configuring the sensor to output binary message types since this allows much more flexibility in what type of data we receive. The easiest way to do this is to first read the current binary output configuration and then modify it for our needs.</p>
<p class="startli"><code>&gt;&gt; br = ez.Sensor.ReadBinaryOutput1()</code></p>
<p class="startli">Execute the commands below to configure the <code>br</code> structure for outputting binary data.</p>
<p class="startli"><code>&gt;&gt; br.AsyncMode = AsyncMode.Port1</code><br />
 <code>&gt;&gt; br.RateDivisor = 100</code><br />
 <code>&gt;&gt; br.CommonField = bitor(bitor(CommonGroup.TimeStartup, CommonGroup.YawPitchRoll), CommonGroup.Imu)</code></p>
<p class="startli">Now send the update <code>br</code> structure to the sensor.</p>
<p class="startli"><code>&gt;&gt; ez.Sensor.WriteBinaryOutput1(br)</code></p>
<p class="startli">The sensor should now be outputting new data types are these can be seen by executing the commands below.</p>
<p class="startli"><code>&gt;&gt; ez.CurrentData.TimeStartup</code><br />
 <code>&gt;&gt; ez.CurrentData.YawPitchRoll</code><br />
 <code>&gt;&gt; ez.CurrentData.AccelerationUncompensated</code><br />
 <code>&gt;&gt; ez.CurrentData.AngularRateUncompensated</code></p>
</li>
<li><p class="startli">Often you will want to get vector data from the VectorNav .NET Library into matrix format so that further computations can be done within the MATLAB environment. This is accomplished by first converting the vector to an array and then calling the appropriate conversion function from MATLAB. The snippet below shows how to get the yaw, pitch, roll into a native matrix format of MATLAB.</p>
<p class="startli"><code>&gt;&gt; native = single(ez.CurrentData.YawPitchRoll.ToArray())</code></p>
</li>
<li><p class="startli">Once you are done using the sensor, it is a good idea to disconnect the sensor.</p>
<p class="startli"><code>&gt;&gt; ez.Disconnect()</code></p>
</li>
</ol>
<div class="fragment"></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 3 2017 18:27:21 for VectorNav MATLAB Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
